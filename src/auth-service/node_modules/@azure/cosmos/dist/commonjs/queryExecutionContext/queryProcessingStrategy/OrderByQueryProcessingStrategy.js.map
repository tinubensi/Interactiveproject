{"version":3,"file":"OrderByQueryProcessingStrategy.js","sourceRoot":"","sources":["../../../../src/queryExecutionContext/queryProcessingStrategy/OrderByQueryProcessingStrategy.ts"],"names":[],"mappings":";AAAA,uCAAuC;AACvC,kCAAkC;;;AAGlC,yHAAwH;AAKxH;;;GAGG;AACH,MAAa,8BAA8B;IACZ;IAA7B,YAA6B,UAAiB;QAAjB,eAAU,GAAV,UAAU,CAAO;IAAG,CAAC;IAClD;;OAEG;IACH,yBAAyB,CACvB,WAA4E;QAE5E,MAAM,YAAY,GAAG,WAA4C,CAAC;QAClE,MAAM,IAAI,GAAQ,EAAE,CAAC;QACrB,IAAI,YAAY,CAAC,YAAY;YAAE,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC,YAAY,CAAC;QAC7E,IAAI,YAAY,CAAC,WAAW;YAAE,IAAI,CAAC,GAAG,GAAG,YAAY,CAAC,WAAW,CAAC;QAClE,OAAO,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC;IACzD,CAAC;IAED;;OAEG;IACH,mBAAmB,CACjB,WAA4E;QAE5E,MAAM,YAAY,GAAG,WAA4C,CAAC;QAClE,OAAO;YACL,YAAY,EAAE,YAAY,CAAC,YAAY;YACvC,GAAG,EAAE,YAAY,CAAC,WAAW;YAC7B,SAAS,EAAE,YAAY,CAAC,SAAS;YACjC,UAAU,EAAE,IAAI,CAAC,UAAU;SAC5B,CAAC;IACJ,CAAC;IAED;;OAEG;IACH,yBAAyB,CACvB,aAAwC,EACxC,iBAAqC,EACrC,sBAA8B;QAE9B,IAAI,CAAC,aAAa;YAAE,OAAO,SAAS,CAAC;QACrC,MAAM,iBAAiB,GAAG,iBAAiB,KAAK,sBAAsB,CAAC;QACvE,OAAO,iBAAiB,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,SAAS,CAAC;IACvD,CAAC;IAED;;OAEG;IACH,sBAAsB,CACpB,iBAAyB;QAEzB,OAAO,IAAA,qEAAkC,EAAC,iBAAiB,CAAC,CAAC;IAC/D,CAAC;CACF;AAnDD,wEAmDC","sourcesContent":["// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT License.\n\nimport type { OrderByQueryContinuationToken } from \"../../documents/ContinuationToken/OrderByQueryContinuationToken.js\";\nimport { parseOrderByQueryContinuationToken } from \"../../documents/ContinuationToken/OrderByQueryContinuationToken.js\";\nimport type { CompositeQueryContinuationToken } from \"../../documents/ContinuationToken/CompositeQueryContinuationToken.js\";\nimport type { FilterContext } from \"../queryFilteringStrategy/FilterStrategy.js\";\nimport type { QueryProcessingStrategy } from \"./QueryProcessingStrategy.js\";\n\n/**\n * Strategy for processing ORDER BY queries\n * @hidden\n */\nexport class OrderByQueryProcessingStrategy implements QueryProcessingStrategy {\n  constructor(private readonly sortOrders: any[]) {}\n  /**\n   * Creates additional query info from ORDER BY continuation token\n   */\n  createAdditionalQueryInfo(\n    parsedToken: OrderByQueryContinuationToken | CompositeQueryContinuationToken,\n  ): any {\n    const orderByToken = parsedToken as OrderByQueryContinuationToken;\n    const info: any = {};\n    if (orderByToken.orderByItems) info.orderByItems = orderByToken.orderByItems;\n    if (orderByToken.documentRid) info.rid = orderByToken.documentRid;\n    return Object.keys(info).length > 0 ? info : undefined;\n  }\n\n  /**\n   * Creates filter context for ORDER BY continuation token processing\n   */\n  createFilterContext(\n    parsedToken: OrderByQueryContinuationToken | CompositeQueryContinuationToken,\n  ): FilterContext | undefined {\n    const orderByToken = parsedToken as OrderByQueryContinuationToken;\n    return {\n      orderByItems: orderByToken.orderByItems,\n      rid: orderByToken.documentRid,\n      skipCount: orderByToken.skipCount,\n      sortOrders: this.sortOrders,\n    };\n  }\n\n  /**\n   * For ORDER BY queries, only apply filter to the target partition (last range in continuation)\n   */\n  getPartitionFilterContext(\n    filterContext: FilterContext | undefined,\n    targetPartitionId: string | undefined,\n    partitionTargetRangeId: string,\n  ): FilterContext | undefined {\n    if (!filterContext) return undefined;\n    const isTargetPartition = targetPartitionId === partitionTargetRangeId;\n    return isTargetPartition ? filterContext : undefined;\n  }\n\n  /**\n   * Parses ORDER BY continuation token\n   */\n  parseContinuationToken(\n    continuationToken: string,\n  ): OrderByQueryContinuationToken | CompositeQueryContinuationToken {\n    return parseOrderByQueryContinuationToken(continuationToken);\n  }\n}\n"]}